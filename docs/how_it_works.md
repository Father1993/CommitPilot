# Как это работает

> Краткое объяснение принципа работы CommitPilot

## Общий принцип

CommitPilot автоматизирует процесс создания коммитов, используя искусственный интеллект для генерации осмысленных сообщений на основе анализа ваших изменений.

## Схема работы

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ Получение   │     │ Анализ      │     │ Генерация   │     │ Создание    │
│ изменений   │ ──> │ изменений   │ ──> │ сообщения   │ ──> │ коммита     │
│ (git diff)  │     │ с помощью AI│     │ для коммита │     │ и push      │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
```

## Шаги выполнения

1. **Получение изменений**

    - Выполняет `git status` для определения изменённых файлов
    - Выполняет `git diff` для получения содержимого изменений

2. **Анализ изменений**

    - Отправляет diff и статус в выбранный AI API
    - Ограничивает размер отправляемых данных для оптимизации

3. **Генерация сообщения**

    - AI анализирует изменения и создаёт сообщение в формате Conventional Commits
    - Формат: `тип(область): сообщение`

4. **Создание коммита**
    - Выполняет `git add .` для добавления всех изменений
    - Выполняет `git commit -m "..."` с сгенерированным сообщением
    - При необходимости выполняет `git push` в указанную ветку

## Поддерживаемые AI провайдеры

### Hugging Face (по умолчанию)

-   Использует модель `HuggingFaceH4/zephyr-7b-beta`
-   Бесплатное API с некоторыми ограничениями
-   Хорошо работает для большинства случаев

### OpenAI

-   Использует модель `gpt-3.5-turbo`
-   Требует платный API ключ
-   Может давать более точные результаты

## Интеграция с Git

### Git Hooks

Для автоматического создания сообщений при обычном `git commit`:

1. При установке копируется hook `prepare-commit-msg` в директорию `.git/hooks/`
2. При вызове `git commit` без сообщения, hook автоматически запускает скрипт
3. Сгенерированное сообщение вставляется в редактор коммита

### Конфигурация

Все настройки хранятся в файле `config.ini`:

```ini
[DEFAULT]
api_provider = huggingface     # Выбор AI провайдера
huggingface_token = xxx        # API ключ для Hugging Face
openai_token = xxx             # API ключ для OpenAI
branch = dev                   # Ветка по умолчанию для push
max_diff_size = 5000           # Максимальный размер diff
```

## Структура проекта

```
CommitPilot/                  # Директория проекта
├── auto_commit.py            # Основной скрипт
├── openai_support.py         # Модуль для OpenAI
├── prepare-commit-msg        # Git hook для установки
├── install.sh                # Установочный скрипт
├── config.ini                # Файл конфигурации
└── docs/                     # Документация
    ├── installation.md       # Руководство по установке
    ├── how_it_works.md       # Принцип работы
    ├── examples.md           # Примеры использования
    └── development.md        # Руководство для разработчиков
```

## Варианты использования

### 1. Использование в репозитории CommitPilot

Для работы с самим проектом CommitPilot, просто используйте команды после установки:

```bash
acommit
acommit-here
```

### 2. Использование в другом проекте через глобальные алиасы

После установки CommitPilot, его команды доступны из любой директории:

```bash
cd /путь/к/другому/проекту
acommit
```

### 3. Использование в другом проекте через Git hook

Установка Git hook в другой проект для автоматической генерации сообщений:

```bash
cp /путь/к/CommitPilot/prepare-commit-msg /путь/к/проекту/.git/hooks/
```

## Безопасность и конфиденциальность

-   Ваш код отправляется в API для анализа (в ограниченном объеме)
-   Используются только изменения, которые вы собираетесь коммитить
-   API ключи хранятся локально в файле конфигурации
-   Размер отправляемого diff ограничен (по умолчанию 5000 символов)
-   Рекомендуется добавить `config.ini` в `.gitignore` для защиты API ключей
