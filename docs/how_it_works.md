# Как это работает

> Краткое объяснение принципа работы CommitPilot

## Общий принцип

CommitPilot автоматизирует процесс создания коммитов, используя искусственный интеллект для генерации осмысленных сообщений на основе анализа ваших изменений.

## Схема работы

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ Получение   │     │ Анализ      │     │ Генерация   │     │ Создание    │
│ изменений   │ ──> │ изменений   │ ──> │ сообщения   │ ──> │ коммита     │
│ (git diff)  │     │ с помощью AI│     │ для коммита │     │ и push      │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
```

## Шаги выполнения

1. **Получение изменений**

    - Выполняет `git status` для определения изменённых файлов
    - Выполняет `git diff` для получения содержимого изменений

2. **Анализ изменений**

    - Отправляет diff и статус в выбранный AI API
    - Ограничивает размер отправляемых данных для оптимизации

3. **Генерация сообщения**

    - AI анализирует изменения и создаёт сообщение в формате Conventional Commits
    - Формат: `тип(область): сообщение`

4. **Создание коммита**
    - Выполняет `git add .` для добавления всех изменений
    - Выполняет `git commit -m "..."` с сгенерированным сообщением
    - При необходимости выполняет `git push` в указанную ветку

## Поддерживаемые AI провайдеры

### AITUNNEL (по умолчанию)

-   Использует модель `deepseek-r1` (настраивается в конфигурации)
-   Совместим с OpenAI API
-   Поддерживает множество моделей через единый API
-   Токен можно указать в файле `.env` как `AI_TUNNEL=sk-aitunnel-xxx`
-   Рекомендуется для использования

### Hugging Face

-   Использует модель `mistralai/Mixtral-8x7B-Instruct-v0.1`
-   Бесплатное API с некоторыми ограничениями
-   Хорошо работает для большинства случаев

### OpenAI

-   Использует модель `gpt-4o-mini` (при наличии нового SDK) или `gpt-3.5-turbo`
-   Требует платный API ключ
-   Может давать более точные результаты

## Интеграция с Git

### Git Hooks

Для автоматического создания сообщений при обычном `git commit`:

1. При установке копируется hook `prepare-commit-msg` в директорию `.git/hooks/`
2. При вызове `git commit` без сообщения, hook автоматически запускает скрипт
3. Сгенерированное сообщение вставляется в редактор коммита

### Конфигурация

Настройки можно хранить в файле `.env` (рекомендуется) или `config.ini`:

**Файл .env:**
```env
AI_TUNNEL=sk-aitunnel-ваш_токен
```

**Файл config.ini:**
```ini
[DEFAULT]
api_provider = aitunnel        # Выбор AI провайдера (aitunnel, huggingface, openai)
aitunnel_token = xxx           # API ключ для AITUNNEL
aitunnel_base_url = https://api.aitunnel.ru/v1/
aitunnel_model = deepseek-r1   # Модель для использования
huggingface_token = xxx        # API ключ для Hugging Face
openai_token = xxx             # API ключ для OpenAI
branch = dev                   # Ветка по умолчанию для push
max_diff_size = 5000           # Максимальный размер diff
```

## Структура проекта

```
CommitPilot/                  # Директория проекта
├── auto_commit.py            # Основной скрипт
├── openai_support.py         # Модуль для OpenAI
├── prepare-commit-msg        # Git hook для установки
├── install.sh                # Установочный скрипт
├── config.ini                # Файл конфигурации
└── docs/                     # Документация
    ├── installation.md       # Руководство по установке
    ├── how_it_works.md       # Принцип работы
    ├── examples.md           # Примеры использования
    └── development.md        # Руководство для разработчиков
```

## Варианты использования

### 1. Использование в репозитории CommitPilot

Для работы с самим проектом CommitPilot, просто используйте команды после установки:

```bash
acommit
acommit-here
```

### 2. Использование в другом проекте через глобальные алиасы

После установки CommitPilot, его команды доступны из любой директории:

```bash
cd /путь/к/другому/проекту
acommit
```

### 3. Использование в другом проекте через Git hook

Установка Git hook в другой проект для автоматической генерации сообщений:

```bash
cp /путь/к/CommitPilot/prepare-commit-msg /путь/к/проекту/.git/hooks/
```

## Безопасность и конфиденциальность

-   Ваш код отправляется в API для анализа (в ограниченном объеме)
-   Используются только изменения, которые вы собираетесь коммитить
-   API ключи хранятся локально в файле `.env` или `config.ini`
-   Размер отправляемого diff ограничен (по умолчанию 5000 символов)
-   Файлы `.env` и `config.ini` уже добавлены в `.gitignore` для защиты API ключей
-   Рекомендуется использовать файл `.env` для хранения токенов
