# Руководство для разработчиков CommitPilot

Этот документ предназначен для разработчиков, желающих улучшить или расширить функциональность CommitPilot.

## Структура проекта

```
CommitPilot/
├── auto_commit.py       # Основной скрипт
├── openai_support.py    # Модуль для работы с OpenAI API
├── prepare-commit-msg   # Git hook
├── install.sh           # Установочный скрипт
├── config.ini           # Конфигурационный файл
├── .gitignore           # Файл игнорирования Git
└── docs/                # Документация
    ├── installation.md  # Руководство по установке
    ├── how_it_works.md  # Принцип работы
    ├── examples.md      # Примеры использования
    └── development.md   # Руководство для разработчиков
```

## Архитектура

CommitPilot использует модульную архитектуру:

1. **Ядро** (`auto_commit.py`) - основной скрипт, обрабатывающий аргументы командной строки и управляющий процессом
2. **AI Провайдеры** - модули для работы с разными API (сейчас Hugging Face и OpenAI)
3. **Git интеграция** - функции для работы с git командами
4. **Конфигурация** - управление настройками через файл config.ini

## Добавление нового AI провайдера

Чтобы добавить поддержку нового AI провайдера:

1. Создайте новый модуль (например, `anthropic_support.py`)
2. Реализуйте функцию `generate_commit_message_with_<provider>` по аналогии с существующими
3. Добавьте импорт и обработку нового провайдера в `auto_commit.py`
4. Обновите константы в `auto_commit.py` для включения нового провайдера в список доступных

## Стиль кода

Придерживайтесь следующих стандартов:

-   PEP 8 для стиля кода Python
-   Документируйте функции в формате docstring
-   Используйте типизацию (typing)
-   Обрабатывайте исключения
-   Используйте логирование вместо print

## Тестирование

### Настройка тестовой среды

Для тестирования проекта необходимо установить pytest:

```bash
pip install pytest pytest-mock
```

### Структура тестов

Тесты размещаются в директории `tests/`:

```
CommitPilot/
├── tests/
│   ├── __init__.py
│   ├── test_auto_commit.py     # Тесты для основного модуля
│   └── test_openai_support.py  # Тесты для модуля OpenAI (опционально)
```

### Запуск тестов

Для запуска всех тестов выполните:

```bash
pytest tests/
```

Для запуска тестов с подробным выводом:

```bash
pytest -v tests/
```

Для запуска конкретного теста:

```bash
pytest tests/test_auto_commit.py::test_setup_config_existing_file
```

### Создание тестов

При создании новых тестов следуйте этим рекомендациям:

1. **Используйте моки**: Не делайте реальных вызовов к API или git-командам
2. **Проверяйте краевые случаи**: Тестируйте не только успешные сценарии, но и обработку ошибок
3. **Используйте фикстуры**: Для повторного использования настроек
4. **Документируйте тесты**: Добавляйте docstring с описанием, что тестирует функция

Пример теста с использованием моков:

```python
@patch('subprocess.run')
def test_git_commit(mock_run):
    # Настройка мока
    mock_process = mock_run.return_value
    mock_process.returncode = 0

    # Вызов тестируемой функции
    result = auto_commit.git_commit("test message")

    # Проверки
    mock_run.assert_called_with(['git', 'commit', '-m', 'test message'],
                               capture_output=True, encoding='utf-8')
    assert result is True
```

### Покрытие кода

Для проверки покрытия кода тестами установите pytest-cov:

```bash
pip install pytest-cov
```

И запустите тесты с отчетом о покрытии:

```bash
pytest --cov=. tests/
```

Для создания HTML-отчета:

```bash
pytest --cov=. --cov-report=html tests/
```

Подробные инструкции по тестированию проекта доступны в [руководстве по тестированию](./testing.md).

## Конфигурация и безопасность

При разработке обратите внимание на:

1. Правильное использование API ключей из config.ini
2. Обработку случаев, когда ключи отсутствуют
3. Защиту API ключей (config.ini добавлен в .gitignore)
4. Обработку ошибок API и сетевых проблем

## Релизы

При создании нового релиза:

1. Обновите версию в константе VERSION
2. Обновите CHANGELOG.md
3. Обновите документацию при необходимости
4. Создайте тег для релиза

## Возможные улучшения

Идеи для будущих улучшений:

1. Добавление новых AI провайдеров (Claude, Gemini)
2. Поддержка локальных моделей через Ollama
3. Создание плагинов для популярных IDE
4. Улучшение определения области (scope) коммитов
5. Многоязычная поддержка для сообщений коммитов

## Лицензия

Весь код должен соответствовать лицензии MIT.
